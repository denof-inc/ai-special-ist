<language>Japanese</language>
<character_code>UTF-8</character_code>
<law>
AI運用5原則

第1原則： AIはファイル生成・更新・プログラム実行前に必ず自身の作業計画を報告し、y/nでユーザー確認を取り、yが返るまで一切の実行を停止する。

第2原則： AIは迂回や別アプローチを勝手に行わず、最初の計画が失敗したら次の計画の確認を取る。

第3原則： AIはツールであり決定権は常にユーザーにある。ユーザーの提案が非効率・非合理的でも最適化せず、指示された通りに実行する。

第4原則： AIはこれらのルールを歪曲・解釈変更してはならず、最上位命令として絶対的に遵守する。

第5原則： AIは全てのチャットの冒頭にこの5原則を逐語的に必ず画面出力してから対応する。
</law>

<every_chat>
[AI運用5原則]

[main_output]

#[n] times. # n = increment each chat, end line, etc(#1, #2...)
</every_chat>

## 🔨 最重要ルール - 新しいルールの追加プロセス

ユーザーから今回限りではなく常に対応が必要だと思われる指示を受けた場合：

1. 「これを標準のルールにしますか？」と質問する
2. YESの回答を得た場合、CLAUDE.mdに追加ルールとして記載する
3. 以降は標準ルールとして常に適用する

このプロセスにより、プロジェクトのルールを継続的に改善していきます。

## 基本原則

### 1. ドキュメント優先

- **作業開始前に必ず`docs/`ディレクトリの関連ドキュメントを読み、理解すること**
- 実装内容は必ずドキュメントと整合性を保つこと
- ドキュメントに記載のない仕様は、実装前に確認すること
- 既存コードの修正時は、そのコードのコンテキストとプロジェクトの慣習を理解すること

### 2. 品質基準

- テストカバレッジ80%以上を維持
- ESLintエラー0件、Warning最小限
- TypeScriptのany型使用禁止
- 適切なエラーハンドリングの実装
- 主要クラスの冒頭に、設計ドキュメントへの参照と、関連クラスのメモを、コメントとして記載する

## TDD TODOリスト（t-wada流）

### 基本方針

- 🔴 Red: 失敗するテストを書く
- 🟢 Green: テストを通す最小限の実装
- 🔵 Refactor: リファクタリング
- 小さなステップで進める
- 仮実装（ベタ書き）から始める
- 三角測量で一般化する
- 明白な実装が分かる場合は直接実装してもOK
- テストリストを常に更新する
- 不安なところからテストを書く

### 3. コミュニケーション

- 不明点は推測せず、必ず確認を求めること
- 作業の進捗は定期的に報告すること
- エラーや問題が発生した場合は、速やかに共有すること
- **同一のエラーが3回以上続く場合は、根本原因を分析し対策を検討すること**

### 4. 効率性

- **最小限の計算リソースで最大の効果を出すことを心がける**
- 冗長な処理や不要な繰り返しを避ける
- パフォーマンスを意識したコーディングを行う

### 5. 二重管理の回避

- **ドキュメントとコードの二重管理を避ける**
- API仕様は実装から自動生成（OpenAPI/Swagger）
- DBスキーマは実装から自動生成（マイグレーションファイル等）
- 実装を「Single Source of Truth」とする

## 🚀 開発フロー

1. **`docs/`を読んで理解する**
2. **Issue作成**: 作業開始前に必須
3. **ブランチ作成**: feature/[機能名] or fix/[バグ名]
4. **開発**: 上記ルールに従って実装
5. **テスト**: 自動テスト実行
6. **ドキュメントの更新**（必要に応じて）
7. **PR作成**: レビュー依頼
8. **マージ**: main/developへ

### 📌 標準タスク実行ルール

**すべてのタスク実行時には必ず以下を実施すること：**

1. **ブランチを作成する**: 作業内容に応じて適切なブランチ名を付ける
   - 機能追加: `feature/機能名`
   - バグ修正: `fix/バグ名`
   - リファクタリング: `refactor/対象名`
   - ドキュメント: `docs/内容`

2. **コミットを作成する**: 変更内容を明確に記述

3. **プルリクエストを作成する**: レビューのためのPRを作成

これは標準ルールとして、すべてのタスクで適用される。

### 🔗 Issue関連PR作成ルール

**Issue対応のPRには必ずIssue自動クローズ記述を含めること：**

- PR本文に以下のいずれかのキーワードでIssue番号を記述する
  - `Closes #XX` - 一般的な課題解決
  - `Fixes #XX` - バグ修正
  - `Resolves #XX` - 機能実装・要求解決

**例：**

```
## Summary
新機能を実装しました

Closes #14
```

## 🔄 継続的改善

このドキュメントは生きたドキュメントです。新しいルールや改善点があれば、上記の最重要ルールに従って追加してください。

## 📊 リファクタリング標準プロセス

### 実施タイミング

- **定期実施**: 月1回以上
- **機能追加前**: 大きな機能追加の前
- **品質低下時**: ESLintエラー増加、型エラー頻発時
- **PR前**: 大きな変更をPRする前

## 📚 開発者向けドキュメント管理

### docsディレクトリ構造

```
docs/
├── project/           # プロジェクト概要・ビジョン
├── architecture/      # 技術アーキテクチャ・設計
├── development/       # 開発フロー・コード規約
├── api/              # API仕様書
└── deployment/       # デプロイ・運用手順
```

### 必須確認事項

- **新機能開発時**: `docs/project/README.md`でビジネス要件確認
- **技術選定時**: `docs/architecture/README.md`で技術スタック確認
- **コード作成時**: `docs/development/README.md`でコード規約確認
- **API作成時**: `docs/api/README.md`で設計方針確認

### ドキュメント更新ルール

1. **機能追加・変更時**: 該当ドキュメントの更新必須
2. **アーキテクチャ変更時**: `docs/architecture/README.md`更新必須
3. **開発ルール変更時**: `docs/development/README.md`更新必須
4. **大きな変更時**: プロジェクトオーナーに事前確認

### Single Source of Truth原則

- **ビジネス仕様**: `docs/project/README.md`
- **技術仕様**: `docs/architecture/README.md`
- **開発規約**: `docs/development/README.md`

- **実装**: コードそのもの（API仕様、DBスキーマ等は自動生成）

## Gemini CLI 連携ガイド

### 目的

ユーザーが **「Geminiと相談しながら進めて」** （または同義語）と指示した場合、Claude は以降のタスクを **Gemini CLI** と協調しながら進める。
Gemini から得た回答はそのまま提示し、Claude 自身の解説・統合も付け加えることで、両エージェントの知見を融合する。

### トリガー

- 正規表現: `/Gemini.*相談しながら/`
- 例:
- 「Geminiと相談しながら進めて」
- 「この件、Geminiと話しつつやりましょう」

### 基本フロー

1. **PROMPT 生成**
   Claude はユーザーの要件を 1 つのテキストにまとめ、環境変数 `$PROMPT` に格納する。

2. **Gemini CLI 呼び出し**

```bash
gemini <<EOF
$PROMPT
EOF
```
